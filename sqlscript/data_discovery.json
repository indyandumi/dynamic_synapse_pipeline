{
	"name": "data_discovery",
	"properties": {
		"content": {
			"query": "-- check for duplicates in taxi zone data\n\nUSE nyc_taxi_discovery;\nSELECT\n     location_id,\n     count(1) as number_of_records\nFROM\n    OPENROWSET(\n        BULK 'https://ludostorageaccount.dfs.core.windows.net/nyc-taxidata/raw/taxi_zone.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        FIRSTROW= 2,\n        FIELDTERMINATOR= ',',\n        ROWTERMINATOR='\\n'\n        \n    ) \n    WITH (\n        location_id SMALLINT 1,\n        borough VARCHAR (15) 2,\n        zone VARCHAR (50) 3,\n        service_zone VARCHAR(15) 4\n    )AS [result]\nGROUP BY location_id\nhaving count(1)> 1;\n\n--identify data quality issues in trip total amount\n\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'trip_data_green_parquet/year=2020/month=01/',\n        DATA_SOURCE = 'nyc_taxidata_raw',\n        FORMAT = 'PARQUET'\n    ) AS [result]\n\nSELECT\n   MIN(total_amount) AS min_total_amount,\n   MAX(total_amount) AS max_total_amount,\n   AVG(total_amount) AS avg_total_amount,\n   COUNT(1) AS total_number_of_records,\n   count(total_amount) AS not_null_total_number_records\n\nFROM\n    OPENROWSET(\n        BULK 'trip_data_green_parquet/year=2020/month=01/',\n        DATA_SOURCE = 'nyc_taxidata_raw',\n        FORMAT = 'PARQUET'\n    ) AS [result]\n\n\n--check for total amount values that are less than zero\nSELECT\n     payment_type,COUNT(1) AS number_of_records\nFROM\n    OPENROWSET(\n        BULK 'trip_data_green_parquet/year=2020/month=01/',\n        DATA_SOURCE = 'nyc_taxidata_raw',\n        FORMAT = 'PARQUET'\n    ) AS [result]\nWHERE total_amount < 0\ngroup by payment_type\norder by payment_type;\n\n--Joining more than one file: identify number of trips made from each borough\n\nSELECT\n    taxi_zone.borough, count(1) AS number_of_trips\nFROM\n    OPENROWSET(\n                BULK 'trip_data_green_parquet/year=2020/month=01/',\n                DATA_SOURCE = 'nyc_taxidata_raw',\n                FORMAT = 'PARQUET'\n    ) AS trip_data\n\n    JOIN\n    OPENROWSET(\n                BULK 'taxi_zone.csv',\n                 DATA_SOURCE = 'nyc_taxidata_raw',\n                FORMAT = 'CSV',\n                PARSER_VERSION = '2.0',\n                FIRSTROW= 2,\n                FIELDTERMINATOR= ',',\n                ROWTERMINATOR='\\n'\n        ) \n        WITH (\n              location_id SMALLINT 1,\n              borough VARCHAR (15) 2,\n              zone VARCHAR (50) 3,\n              service_zone VARCHAR(15) 4\n    )AS taxi_zone\n    ON trip_data.PULocationID = taxi_zone.Location_ID\n    GROUP BY taxi_zone.borough\n    ORDER BY number_of_trips;\n   \n\n-- Column level transformations. NUmber of trips maade by durations in hours\nSELECT\n    count(1) as number_of_trips,\n    DATEDIFF(minute, lpep_pickup_datetime, lpep_dropoff_datetime)/60 AS from_hour,\n     DATEDIFF(minute, lpep_pickup_datetime, lpep_dropoff_datetime)/60 + 1 to_hour\nFROM\n    OPENROWSET(\n                BULK 'trip_data_green_parquet/year=2020/month=01/',\n                DATA_SOURCE = 'nyc_taxidata_raw',\n                FORMAT = 'PARQUET'\n    ) AS trip_data\n\n    GROUP BY DATEDIFF(minute, lpep_pickup_datetime, lpep_dropoff_datetime)/60 ,\n     DATEDIFF(minute, lpep_pickup_datetime, lpep_dropoff_datetime)/60 + 1\n    ORDER BY to_hour, from_hour\n\n--Identify the % of cash and credit card trips by borough\n\nSELECT\n    taxi_zone.borough,count(1) AS number_of_trips\nFROM\n    OPENROWSET(\n                BULK 'trip_data_green_parquet/year=2020/month=01/',\n                DATA_SOURCE = 'nyc_taxidata_raw',\n                FORMAT = 'PARQUET'\n    ) AS trip_data\n\n    JOIN\n    OPENROWSET(\n                BULK 'taxi_zone.csv',\n                 DATA_SOURCE = 'nyc_taxidata_raw',\n                FORMAT = 'CSV',\n                PARSER_VERSION = '2.0',\n                FIRSTROW= 2,\n                FIELDTERMINATOR= ',',\n                ROWTERMINATOR='\\n'\n        ) \n        WITH (\n              location_id SMALLINT 1,\n              borough VARCHAR (15) 2,\n              zone VARCHAR (50) 3,\n              service_zone VARCHAR(15) 4\n    )AS taxi_zone\n    ON trip_data.PULocationID = taxi_zone.Location_ID\n    GROUP BY taxi_zone.borough\n    ORDER BY number_of_trips;\n\n\n\nSELECT\n    Count(1) AS total_trips, payment_type, borough\nFROM\n    OPENROWSET(\n                BULK 'trip_data_green_parquet/year=2020/month=01/',\n                DATA_SOURCE = 'nyc_taxidata_raw',\n                FORMAT = 'PARQUET'\n    ) AS trip_data\n\n    JOIN\n    OPENROWSET(\n                BULK 'taxi_zone.csv',\n                 DATA_SOURCE = 'nyc_taxidata_raw',\n                FORMAT = 'CSV',\n                PARSER_VERSION = '2.0',\n                FIRSTROW= 2,\n                FIELDTERMINATOR= ',',\n                ROWTERMINATOR='\\n'\n        ) \n        WITH (\n              location_id SMALLINT ,\n              borough VARCHAR (15) ,\n              zone VARCHAR (50) ,\n              service_zone VARCHAR(15) \n    )AS taxi_zone\n    ON trip_data.PULocationID = taxi_zone.Location_ID\n     Where payment_type IN ('3','1')\n     GROUP BY payment_type,borough\n     ORDER BY payment_type;\n  \n\n\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "nyc_taxi_discovery",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}